<div class="map-layout">
  <!-- Sidebar izquierdo mejorado -->
  <aside class="sidebar-map">
    <!-- Back button mejorado -->
    <button class="back-btn" routerLink="/dashboard" aria-label="Volver al dashboard" title="Volver">
      <span class="back-icon">‚Üê</span>
      <span class="back-text">Regresar</span>
    </button>

    <div class="sidebar-content">
      <!-- Secci√≥n de Rutas -->
      <div class="section">
        <div class="section-header">
          <h3 class="section-title">Rutas disponibles</h3>
          <span class="section-badge">{{ rutas().length }}</span>
        </div>
        
        @if (loading()) {
          <div class="loading-state">
            <div class="spinner-small"></div>
            <p>Cargando rutas...</p>
          </div>
        } @else if (error()) {
          <div class="error-state">
            <span class="error-icon">‚ö†Ô∏è</span>
            <p>{{ error() }}</p>
          </div>
        } @else {
          <div class="items-list">
            @for (r of rutas(); track r.id) {
              <div class="list-item" 
                   [class.selected]="selectedRutaId() === r.id"
                   (click)="selectRuta(r.id)"
                   title="Seleccionar ruta">
                <span class="item-indicator route"></span>
                <div class="item-content">
                  <span class="item-name">{{ r.nombre }}</span>
                  <span class="item-meta">Ruta disponible</span>
                </div>
                <span class="item-arrow">‚Ä∫</span>
              </div>
            }
            @if (rutas().length === 0) {
              <div class="empty-state">Sin rutas disponibles</div>
            }
          </div>
        }
      </div>

      <!-- Secci√≥n de Veh√≠culos -->
      <div class="section" appConductorOnly>
        <div class="section-header">
          <h3 class="section-title">Veh√≠culos</h3>
          <span class="section-badge">{{ vehiculos().length }}</span>
        </div>
        
        @if (loading()) {
          <div class="loading-state">
            <div class="spinner-small"></div>
            <p>Cargando veh√≠culos...</p>
          </div>
        } @else {
          <div class="items-list">
            @for (v of vehiculos(); track v.id) {
              <div class="list-item vehicle-item"
                   [class.selected]="selectedVehiculoId() === v.id"
                   (click)="selectVehiculo(v.id)"
                   title="Seleccionar veh√≠culo">
                <span class="item-icon">üöõ</span>
                <div class="item-content">
                  <span class="item-name">{{ v.placa || v.id }}</span>
                  <span class="item-meta">Disponible</span>
                </div>
                <span class="item-arrow">‚Ä∫</span>
              </div>
            }
            @if (vehiculos().length === 0) {
              <div class="empty-state">Sin veh√≠culos</div>
            }
          </div>
        }
      </div>

      <!-- Controles de conductor -->
      <div class="section controls-section" appConductorOnly>
        <div class="controls-group">
          <button class="btn btn-primary" 
                  (click)="iniciarRecorrido()"
                  [disabled]="!selectedRutaId() || !selectedVehiculoId() || !!currentRecorridoId() || isStarting()">
            <span class="btn-icon">‚ñ∂</span>
            <span class="btn-text">Iniciar Recorrido</span>
          </button>
          
          <button class="btn btn-danger" 
                  (click)="finalizarRecorrido()"
                  [disabled]="!currentRecorridoId()">
            <span class="btn-icon">‚èπ</span>
            <span class="btn-text">Finalizar</span>
          </button>
        </div>

        @if (currentRecorridoId()) {
          <div class="status-box">
            <div class="status-indicator live"></div>
            <div class="status-content">
              <span class="status-label">En recorrido</span>
              <span class="status-value">{{ currentRecorridoRutaName() || '‚Äî' }}</span>
            </div>
          </div>
        }
      </div>
    </div>
  </aside>

  <!-- Mapa principal -->
  <section class="map-container">
    <div id="map" class="map"></div>
  </section>
</div>
