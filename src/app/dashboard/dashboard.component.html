<div class="dashboard" [class.dark]="theme() === 'dark'">
  <div class="layout">
    <aside class="sidebar">
      <div class="profile">
        @if (avatar()) {
          <div class="avatar"><img src="{{ avatar() }}" alt="Avatar" class="avatar-img"/></div>
        } @else {
          <div class="avatar">{{ userName().charAt(0).toUpperCase() }}</div>
        }
        <div class="profile-info">
          <div class="name">{{ userName() }}</div>
          <div class="sub">{{ role() ? (role() | titlecase) : 'Usuario' }}</div>
        </div>
      </div>

      <nav class="side-nav">
        <a routerLink="/dashboard" class="nav-item active"><span class="material-symbols-rounded">dashboard</span> <span>Inicio</span></a>
        <a routerLink="/mapa" class="nav-item"><span class="material-symbols-rounded">map</span> <span>Mapa en Vivo</span></a>
        <a routerLink="/perfil" class="nav-item"><span class="material-symbols-rounded">person</span> <span>Mi Perfil</span></a>
        @if (role() === 'admin') {
          <a routerLink="/admin" class="nav-item"><span class="material-symbols-rounded">admin_panel_settings</span> <span>Administraci√≥n</span></a>
        }
      </nav>

      <div class="side-quick">
        <button class="btn-ghost" routerLink="/perfil"><span class="material-symbols-rounded">person_outline</span> Mi Perfil</button>
        <button class="btn-logout small" (click)="logout()"><span class="material-symbols-rounded">logout</span> Cerrar Sesi√≥n</button>
      </div>
    </aside>

    <main class="main">
      <!-- Hero Header -->
      <header class="hero-header">
        <div class="hero-content">
          <div>
            <h1 class="hero-title">{{ greeting() }}, {{ userName() }}! üëã</h1>
            <p class="hero-subtitle">Bienvenido a tu panel de control de recolecci√≥n sostenible</p>
          </div>
          <div class="hero-quick-actions">
            <a routerLink="/mapa" class="quick-btn">
              <span class="material-symbols-rounded">map</span>
              <span>Ver Mapa</span>
            </a>
            <a routerLink="/perfil" class="quick-btn">
              <span class="material-symbols-rounded">edit</span>
              <span>Editar Perfil</span>
            </a>
          </div>
        </div>
      </header>

      @if (loading()) {
        <div class="loading-container">
          <div class="spinner"></div>
          <p>Cargando datos...</p>
        </div>
      } @else if (error()) {
        <div class="error-box">
          <span class="material-symbols-rounded error-icon">error</span>
          <div class="error-content">
            <h4>Error al cargar datos</h4>
            <p>{{ error() }}</p>
          </div>
        </div>
      } @else {
        <!-- Stats Grid -->
        <section class="stats-section">
          <div class="stats-grid">
            <div class="stat-card stat-vehicles">
              <div class="stat-header">
                <span class="material-symbols-rounded stat-icon">local_shipping</span>
                <span class="stat-badge">Activos</span>
              </div>
              <div class="stat-body">
                <div class="stat-number">{{ vehiculosCount() }}</div>
                <p class="stat-label">Veh√≠culos Activos</p>
                <div class="stat-chart">
                  <canvas #vehChart class="sparkline-chart"></canvas>
                </div>
              </div>
            </div>

            <div class="stat-card stat-routes">
              <div class="stat-header">
                <span class="material-symbols-rounded stat-icon">route</span>
                <span class="stat-badge">Disponibles</span>
              </div>
              <div class="stat-body">
                <div class="stat-number">{{ rutasCount() }}</div>
                <p class="stat-label">Rutas Disponibles</p>
                <div class="stat-chart">
                  <canvas #rutasChart class="sparkline-chart"></canvas>
                </div>
              </div>
            </div>

            @if (role() === 'admin') {
              <div class="stat-card stat-drivers">
                <div class="stat-header">
                  <span class="material-symbols-rounded stat-icon">groups</span>
                  <span class="stat-badge">Total</span>
                </div>
                <div class="stat-body">
                  <div class="stat-number">{{ conductoresCount() }}</div>
                  <p class="stat-label">Conductores</p>
                  <p class="stat-description">En la plataforma</p>
                </div>
              </div>
            }
          </div>
        </section>

        <!-- Featured Section -->
        <section class="featured-section">
          <h2 class="section-title">Acceso R√°pido</h2>
          
          <div class="featured-grid">
            <!-- Live Map - Featured -->
            <a routerLink="/mapa" class="featured-card featured-map">
              <div class="featured-overlay">
                <span class="material-symbols-rounded">location_on</span>
              </div>
              <div class="mini-map-container">
                <canvas #miniMap class="mini-map"></canvas>
              </div>
              <div class="featured-content">
                <h3>Mapa en Vivo</h3>
                <p>Rastrear rutas y veh√≠culos en tiempo real</p>
              </div>
            </a>

            <!-- Quick Stats -->
            <div class="featured-card featured-info">
              <div class="featured-header">
                <span class="material-symbols-rounded">analytics</span>
                <h3>Estado Operacional</h3>
              </div>
              <div class="info-list">
                <div class="info-item">
                  <span class="info-label">Operaci√≥n</span>
                  <span class="info-value healthy">En l√≠nea</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Pr√≥xima recolecci√≥n</span>
                  <span class="info-value">Hoy, 14:30</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Puntos de recolecci√≥n</span>
                  <span class="info-value">3 cercanos</span>
                </div>
              </div>
            </div>

            <!-- Profile Quick Access -->
            <a routerLink="/perfil" class="featured-card featured-profile">
              <div class="profile-badge">
                @if (avatar()) {
                  <img src="{{ avatar() }}" alt="Avatar" class="profile-avatar" />
                } @else {
                  <div class="profile-avatar-placeholder">{{ userName().charAt(0).toUpperCase() }}</div>
                }
              </div>
              <div class="featured-content">
                <h3>Mi Perfil</h3>
                <p>Actualizar informaci√≥n y preferencias</p>
                <div class="featured-link">Configurar <span class="arrow">‚Üí</span></div>
              </div>
            </a>
          </div>
        </section>
      }
    </main>
  </div>
</div>
